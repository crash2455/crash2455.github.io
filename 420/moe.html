<html>

<head>
  <link rel="stylesheet" type="text/css" href="moe.css">
  <link href="https://fonts.googleapis.com/css?family=Press+Start+2P" rel="stylesheet">
  <script src="./howler.js-master/dist/howler.js"></script>
  <link rel="stylesheet" type="text/css" href="https://csshake.surge.sh/csshake.min.css">
</head>


<body id='moe'>
  <div id='splash'>THIS IS A TRIBUTE TO 420.MOE MADE IN HTML AND JAVASCRIPT
    <br><br><br><br><a href="#" id="music">CLICK HERE TO MOKE SWEED</a></div>
  <div id='ticker'></div>
  <div id='beatDrop'></div>

  <div id='menu'>
    <ul>
      <li><a href="#" id="restOfMyLife">RESTOFMYLIFE</a></li>
      <li><a href="#" id="greenAndPurple">GREENANDPURPLE</a></li>
      <li><a href="#" id="holdItIn">HOLDITIN</a></li>
      <li><a href="#" id="smokinRollin">SMOKINROLLIN</a></li>
    </ul>
  </div>
</body>

<script>
  //variables to hold onto timings for iterators
  var t;
  var m;

  //arrays for our visual beat tickers
  var ticker = [];
  var backTicker = [];

  //external counter for last slide shown, starts initialized at 1
  var moeExt = 1;

  //song time finder
  var seek = 0;

  //song rhythm array storage
  var restOfLife = ['x', '.', '.', 'o', '.', '.', 'x', '.', '.', '.', '.', '.', '.', 'o', '.', 'x', '.', '.', 'o', '.', 'x', '.', '.', '.', '.', 'x', 'o', '.', '.', '.', 'o', '.', '.', 'x', '.', '.', '.', '.', '.', 'o', '.', '.', 'x', '.', '.', 'o', 'x', '.', '.', '.', '.', '.', 'x', 'o', '.', '.', 'o', '.', '.', 'x', '.', '.', '.', '.', '.', '.', 'o', '.', 'x', '.', '.', '.', '.', 'x', '.', '.', '.', '.', 'x', 'o', '.', '.', '.', 'o', '.', '.', 'x', '.', '.', '.', '.', '.', '.', 'o', '.', 'x', '.', '.', 'o', 'x', '.', '.', '.', '.', '.', 'x', 'o', '.', '.', 'o', '.', '.', '.', 'x', '.', '.', '.', '.', '.', 'o', '.', '.', 'x', '.', '.', 'o', 'x', '.', '.', '.', '.', '.', 'x', 'o', '.', '.', 'o', '.', '.', 'x', '.', '.', '.', '.', '.', '.', 'o', '.', 'x', '.', '.', 'o', '.', 'x', '.', '.', '.', '.', 'x', 'o', '.', '.', '.', 'o', '.', '.', 'x', '.', '.', '.', '.', '.', '.', 'o', '.', 'x', '.', '.', 'o', 'x', '.', '.', '.', '.', '.', 'x', 'o', '.', '.', 'o', '.', '.', '.', 'x', '.', '.', '.', '.', 'x', 'o', '.', 'x', '.', '.', '.', 'o', 'x', '.', 'x', 'x', '.', 'x', '.'];
  var greenAndPurple = ['o', '.', '.', '.', '.', '-', '.', '.', '.', '.', 'x', '.', '.', '.', '.', '.', 'o', '.', '.', 'o', '.', '.', '.', '.', 'o', '.', '.', 'o', '.', '.', '.', '.', '.', 'x', '.', '.', '.', '.', '-', '.', '.', '-', '.', 'o', '.', '.', '.', '.', '.', '-', '.', '.', '.', '.', 'x', '.', '.', '.', '.', '.', 'o', '.', '.', 'o', '.', '.', '.', '.', 'o', '.', '.', 'o', '.', '.', '.', '.', '.', 'x', '.', 'o', '.', '.', '.', '.', '.', '.', '.', '.', 'o', '.', '.', '.', '.', '-', '.', '.', '.', '.', 'x', '.', '.', '.', '.', '.', 'o', '.', '.', 'o', '.', '.', '.', '.', 'o', '.', '.', 'o', '.', '.', '.', '.', '.', 'x', '.', '.', '.', '.', '.', '-', '-', '-', '-', '.', 'o', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', 'x', '.', '.', '.', '.', '.', '.', '.', 'o', '.', '.', 'o', '.', 'o', '.', '.', 'o', '.', '.', '.', '.', '.', 'x', '.', 'o', '.', '.', '.', '.', '.', '.', '.', '.', 'o', '.', '.', '.', '.', '-', '.', '.', '.', '.', '.', 'x', '.', '.', '.', '.', 'o', '.', '.', 'o', '.', '.', '.', '.', 'o', '.', '.', 'o', '.', '.', '.', '.', 'x', '.', '.', '.', '.', '.', '-', '.', '.', '-', '.', '.', 'o', '.', '.', '.', '.', '.', '.', '.', '.', '.', 'x', '.', '.', '.', '.', '.', 'o', '.', '.', 'o', '.', '.', '.', '.', 'o', '.', '.', 'o', '.', '.', '.', '.', '.', 'x', '.', 'o', '.', '.', '.', '.', '.', '.', '.', '.', 'o', '.', '.', '.', '.', '-', '.', '.', '.', '.', '.', 'x', '.', '.', '.', '.', 'o', '.', '.', 'o', '.', '.', '.', '.', 'o', '.', '.', 'o', '.', '.', '.', '.', '.', 'x', '.', '.', '.', '.', '.', '-', '-', '-', '-', '.', 'o', '.', '.', '.', '.', '-', '.', '.', '.', '.', '.', 'x', '.', '.', '.', '.', '.', '.', '.', 'o', '.', '.', 'o', '.', 'o', '.', '.', 'o', '.', '.', '.', '.', 'x', '.', '.', 'o', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.', '.'];
  var holdItIn = ['o', '.', '.', '.', '.', '.', '.', 'x', '.', '.', '.', '.', '.', 'o', 'o', 'o', '.', '.', '.', '.', '.', '.', '.', 'x', '.', '.', '.', '.', '.', '.', '.', 'o', '.', '.', '.', '.', '.', '.', 'x', '.', '.', '.', '.', '.', 'o', 'o', 'o', '.', '.', '.', '.', '.', '.', '.', 'x', '.', '.', '.', 'o', '.', '.', '.', 'o', '.', '.', '.', '.', '.', '.', '.', 'x', '.', '.', '.', '.', '.', 'o', 'o', 'o', '.', '.', '.', '.', '.', '.', 'x', '.', '.', '.', '.', '.', '.', '.', 'o', '.', '.', '.', '.', '.', '.', '.', 'x', '.', '.', '.', '.', '.', 'o', 'o', 'o', '.', '.', '.', '.', '.', '.', '.', 'x', '.', '.', '.', 'o', '.', '.', '.', 'o', '.', '.', '.', '.', '.', '.', 'x', '.', '.', '.', '.', '.', 'o', 'o', 'o', '.', '.', '.', '.', '.', '.', '.', 'x', '.', '.', '.', '.', '.', '.', '.', 'o', '.', '.', '.', '.', '.', '.', '.', 'x', '.', '.', '.', '.', 'o', 'o', 'o', '.', '.', '.', '.', '.', '.', '.', 'x', '.', '.', '.', 'o', '.', '.', '.', 'o', '.', '.', '.', '.', '.', '.', '.', 'x', '.', '.', '.', '.', '.', 'o', 'o', 'o', '.', '.', '.', '.', '.', '.', '.', 'x', '.', '.', '.', '.', '.', '.', 'o', '.', '.', '.', '.', '.', '.', '.', 'x', '.', '.', '.', '.', '.', 'o', 'o', 'o', '-', '-', '-', '-', '-', '-', '-', 'x', '-', '-', '-', 'o', '-', '-'];
  var smokinRollin = ['o', '.', '.', 'o', 'x', '.', '.', 'o', '.', '.', '.', 'o', 'o', '.', '.', 'x', 'o', '.', '.', '.', 'o', '.', '.', 'o', '.', 'x', '.', 'o', '.', '.', '.', 'o', 'o', '.', '.', 'x', 'o', '.', '.', '.', 'o', '.', '.', 'o', '.', 'x', '.', 'o', '.', '.', '.', 'o', 'o', '.', '.', 'x', 'o', '.', '.', '.', 'o', '.', '.', 'o', '.', 'x', '.', 'o', '.', '.', '.', 'o', 'o', '.', '.', 'x', 'o', '.', '.', '.'];

  //stock rhythm, starts loaded with first song
  var rhythm = restOfLife;

  //way to keep time
  var metronome = 110;

  function moe() {
    //random color generator, builds r g and b with some bias towards lighter colors
    var r = (128 + (Math.floor(Math.random() * 128))).toString(16);
    var g = (128 + (Math.floor(Math.random() * 128))).toString(16);
    var b = (128 + (Math.floor(Math.random() * 128))).toString(16);
    var hue = r + g + b;
    document.getElementById('moe').style.backgroundColor = '#' + hue;

    //console.log(moe);

    //slide changer, biased to not pick the same image twice
    var moe = ((moeExt + (Math.ceil(Math.random() * 23))) % 24);
    moeExt = moe;
    var moeStr = moe.toString();
    document.getElementById('moe').style.backgroundImage = 'url("./assets/img/' + moeStr + '.png")';
  }

  //a way to make audio work smoothly, also load up one soundtrack to play 7 songs
  var sound = new Howl({
    src: ['./assets/weedloop2.ogg'],
    sprite: {
      restOfMyLife: [0, 25000],
      greenAndPurple: [30000, 55000],
      holdItIn: [60000, 85000],
      smokinRollin: [90000, 105000]
    },
    volume: 0.5
  });

  //external counter to keep track of where we are in the sample
  var musicIndex = 0;

  function musicBox() {
    //a bunch of class removals to avoid animation lingering
    document.getElementById("beatDrop").classList.remove('hidden');
    //document.getElementById('moe').classList.remove('shake-vertical');
    //document.getElementById('moe').classList.remove('shake-horizontal');

    document.getElementById("ticker").innerHTML = backTicker.join('') + ticker.join('');
    document.getElementById("beatDrop").innerHTML = (rhythm[musicIndex] == '.' || rhythm[musicIndex] == '-' ? ' ' : rhythm[musicIndex]) + "</span> "
    if (rhythm[musicIndex] != '.') {
      moe();
      document.getElementById("beatDrop").classList.add('hidden');
      document.getElementById("beatDrop").classList.add('drop');
    }
    if (rhythm[musicIndex] == 'x') {
      //if i can ever figure out how to get the shake to work correctly this will shake vertical
      //document.getElementById('moe').classList.add('shake-vertical');
    }
    else if (rhythm[musicIndex] == 'o') {
      //if i can ever figure out how to get the shake to work correctly this will shake horizontal
      //document.getElementById('moe').classList.add('shake-horizontal');
    }
    //increment index
    musicIndex++;
    //restart loop when we run out of beats
    if (musicIndex == rhythm.length) {
      musicIndex = 0;
      sound.seek(seek);
    }
    //add and remove beats to our visual beat ticker up top
    ticker.shift();
    backTicker.pop();
    ticker.push(rhythm[(musicIndex + 30) % rhythm.length]);
    backTicker.unshift(rhythm[(musicIndex + 30) % rhythm.length]);
    //console.log(rhythm[musicIndex] == ticker[0] ? '' : musicIndex.toString() + ' ' + ticker[0]);
  }


  //chrome actually won't allow audio to autoplay
  //so we made this function which also gives our assets time to load
  //has to be wrapped in a function or it all activates at once
  document.getElementById("music").onclick = function () { play('restOfMyLife') };
  document.getElementById("restOfMyLife").onclick = function () { play('restOfMyLife') };
  document.getElementById("greenAndPurple").onclick = function () { play('greenAndPurple') };
  document.getElementById("holdItIn").onclick = function () { play('holdItIn') };
  document.getElementById("smokinRollin").onclick = function () { play('smokinRollin') };

  function play(song) {
    document.getElementById("splash").style = "display: none";

    //for the love of god reset everything unless you want to enter the speedforce
    clearInterval(m);
    sound.stop();
    ticker.length = 0;
    backTicker.length = 0;
    //rhythm.length = 0;
    musicIndex = 0;

    //see what song is up to play and set parameters accordingly
    switch (song) {
      case 'restOfMyLife':
        rhythm = restOfLife;
        seek = 0;
        metronome = 110;
        break;
      case 'greenAndPurple':
        rhythm = greenAndPurple;
        seek = 30;
        metronome = 66;
        break;
      case 'holdItIn':
        rhythm = holdItIn;
        seek = 60;
        metronome = 110;
        break;
      case 'smokinRollin':
        rhythm = smokinRollin;
        seek = 90;
        metronome = 176;
        break;
    }

    //populate ticker with new beats
    for (var i = 0; i < 30; i++) {
      ticker.push(rhythm[i + 1]);
      backTicker.unshift(rhythm[i + 1]);
    }
    //timings for my shitty laptop:
    //rest of my life: 110ms
    //green and purple: 66ms
    m = setInterval(musicBox, metronome);
    sound.play(song);
    //console.log(song);
  }


</script>

</html>
